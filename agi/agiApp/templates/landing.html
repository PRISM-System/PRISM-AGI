<!DOCTYPE html>
{% load static %}
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRISM-AGI - Welcome</title>
    <link rel="icon" type="image/png" href="{% static 'img/image_logo.png' %}">

    <link rel="stylesheet" href="{% static 'css/reset.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/landing.css' %}">
</head>
<body class="landing-body">
    <div class="landing-container">
        <div class="landing-content">
            <!-- 로고 영역 -->
            <div class="landing-logo">
                <img src="{% static 'img/image_logo.png' %}" alt="PRISM-AGI Logo" class="logo-image">
                <h1 class="landing-title">PRISM-AGI</h1>
                <p class="landing-subtitle">자율제조 AI 에이전트 DEMO</p>
            </div>

            <!-- 설명 영역 -->
            <div class="landing-description">
                <h2 class="description-title">자율제조 AI 에이전트 DEMO</h2>
                <p class="description-text">
                    PRISM-AGI는 다양한 AI 에이전트들을 통합 관리하고<br> 
                    모니터링할 수 있는 차세대 플랫폼(DEMO)입니다.
                </p>
            </div>

            <!-- 액션 버튼 영역 -->
            <div class="landing-actions">
                <button class="landing-btn primary" id="demoButton" style="pointer-events: auto; cursor: pointer; z-index: 10; position: relative;">
                    <span>DEMO 접속</span>
                    <svg class="btn-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                </button>
                <a href="https://github.com/PRISM-System/PRISM-AGI" target="_blank" class="landing-btn secondary">
                    <svg class="btn-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                    </svg>
                    <span>GITHUB</span>
                </a>
            </div>

            <!-- 추가 정보 -->
            <div class="landing-footer">
                <p class="footer-text">
                    DEMO
                </p>
            </div>
        </div>

        <!-- 배경 애니메이션 -->
        <div class="bg-animation">
            <div class="floating-element"></div>
            <div class="floating-element"></div>
            <div class="floating-element"></div>
        </div>
    </div>

    <!-- 로그인 모달 -->
    <div class="institution-modal" id="loginModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">로그인</h2>
                <button class="modal-close" data-action="close">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.3 5.71L12 12.01L5.7 5.71L4.29 7.12L10.59 13.42L4.29 19.72L5.7 21.13L12 14.83L18.3 21.13L19.71 19.72L13.41 13.42L19.71 7.12L18.3 5.71Z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-description">기관 계정으로 로그인해주세요.</p>
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label for="username" class="form-label">아이디</label>
                        <input 
                            type="text" 
                            id="username" 
                            name="username" 
                            class="form-input" 
                            placeholder="아이디를 입력하세요"
                            required
                            autocomplete="username"
                        >
                    </div>
                    <div class="form-group">
                        <label for="password" class="form-label">비밀번호</label>
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            class="form-input" 
                            placeholder="비밀번호를 입력하세요"
                            required
                            autocomplete="current-password"
                        >
                    </div>
                    <div class="form-error" id="loginError" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                        </svg>
                        <span id="loginErrorText">로그인에 실패했습니다.</span>
                    </div>
                    <button type="submit" class="form-submit-btn" id="loginSubmitBtn">
                        <span>로그인</span>
                        <svg class="btn-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                    </button>
                </form>
                <div class="login-footer">
                    <p class="login-help-text">계정이 없으신가요? 관리자에게 문의하세요.</p>
                </div>
                <div class="institution-list" style="display: none;">
                    <div class="institution-item" data-user-id="user_1111" data-institution="서울대학교">
                        <div class="institution-icon">
                            <img src="{% static 'img/seoul.png' %}" alt="서울대학교 로고" class="institution-logo">
                        </div>
                        <div class="institution-info">
                            <h3 class="institution-name">서울대학교</h3>
                        </div>
                        <div class="institution-arrow">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="institution-item" data-user-id="user_2222" data-institution="한양대학교">
                        <div class="institution-icon">
                            <img src="{% static 'img/hanyang.png' %}" alt="한양대학교 로고" class="institution-logo">
                        </div>
                        <div class="institution-info">
                            <h3 class="institution-name">한양대학교</h3>
                        </div>
                        <div class="institution-arrow">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="institution-item" data-user-id="user_3333" data-institution="성균관대학교">
                        <div class="institution-icon">
                            <img src="{% static 'img/sunkyunkwan.png' %}" alt="성균관대학교 로고" class="institution-logo">
                        </div>
                        <div class="institution-info">
                            <h3 class="institution-name">성균관대학교</h3>
                        </div>
                        <div class="institution-arrow">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="institution-item" data-user-id="user_4444" data-institution="카이스트">
                        <div class="institution-icon">
                            <img src="{% static 'img/KAIST.png' %}" alt="카이스트 로고" class="institution-logo">
                        </div>
                        <div class="institution-info">
                            <h3 class="institution-name">카이스트</h3>
                        </div>
                        <div class="institution-arrow">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="institution-item" data-user-id="user_1234" data-institution="비아이매트릭스">
                        <div class="institution-icon">
                            <img src="{% static 'img/bimatrix.png' %}" alt="비아이매트릭스 로고" class="institution-logo">
                        </div>
                        <div class="institution-info">
                            <h3 class="institution-name">비아이매트릭스</h3>
                        </div>
                        <div class="institution-arrow">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('Landing page script loading...');

        // 기본 함수들 정의
        function showModal() {
            console.log('showModal called');
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.add('show');
                // 포커스를 아이디 입력란으로
                setTimeout(() => {
                    document.getElementById('username')?.focus();
                }, 100);
                console.log('Login modal shown');
            } else {
                console.error('Login modal not found');
            }
        }

        function hideModal() {
            console.log('hideModal called');
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.remove('show');
                // 에러 메시지 숨기기
                document.getElementById('loginError').style.display = 'none';
                // 폼 초기화
                document.getElementById('loginForm')?.reset();
                console.log('Login modal hidden');
            }
        }

        async function handleLogin(username, password) {
            console.log('Login attempt:', username);
            
            try {
                const response = await fetch('/django/agi/api/login/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    // 로그인 성공
                    console.log('Login successful:', data);
                    localStorage.setItem('selectedUserId', data.user_id);
                    localStorage.setItem('selectedInstitution', data.institution || '');
                    localStorage.setItem('username', data.username);
                    
                    document.body.classList.add('transitioning');
                    setTimeout(() => {
                        window.location.href = `/django/agi/index/?user_id=${data.user_id}`;
                    }, 300);
                } else {
                    // 로그인 실패
                    showLoginError(data.message || '아이디 또는 비밀번호가 올바르지 않습니다.');
                }
            } catch (error) {
                console.error('Login error:', error);
                showLoginError('로그인 중 오류가 발생했습니다. 다시 시도해주세요.');
            }
        }

        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            const errorText = document.getElementById('loginErrorText');
            if (errorDiv && errorText) {
                errorText.textContent = message;
                errorDiv.style.display = 'flex';
            }
        }

        // DOM 로드 완료 후 이벤트 리스너 등록
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up event listeners...');
            
            // 페이지 로드 애니메이션
            document.body.classList.add('loaded');
            
            // DEMO 접속 버튼 이벤트
            const demoButton = document.getElementById('demoButton');
            if (demoButton) {
                console.log('Demo button found, adding click listener');
                
                // 여러 이벤트 타입으로 등록
                ['click', 'mousedown', 'touchstart'].forEach(eventType => {
                    demoButton.addEventListener(eventType, function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log(`Demo button ${eventType} event fired!`);
                        showModal();
                    }, true); // useCapture = true
                });
                
                // 버튼 스타일 강제 설정
                demoButton.style.cursor = 'pointer';
                demoButton.style.pointerEvents = 'auto';
                demoButton.style.zIndex = '999';
                demoButton.style.position = 'relative';
                
                // 테스트용 hover 이벤트
                demoButton.addEventListener('mouseenter', function() {
                    console.log('Demo button hovered');
                });
                
            } else {
                console.error('Demo button not found!');
            }

            // 모달 닫기 버튼들
            const closeButtons = document.querySelectorAll('[data-action="close"]');
            closeButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    hideModal();
                });
            });

            // 오버레이 클릭으로 닫기
            const overlay = document.querySelector('.modal-overlay');
            if (overlay) {
                overlay.addEventListener('click', hideModal);
            }

            // 로그인 폼 제출 이벤트
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const username = document.getElementById('username').value.trim();
                    const password = document.getElementById('password').value;
                    
                    if (!username || !password) {
                        showLoginError('아이디와 비밀번호를 입력해주세요.');
                        return;
                    }

                    // 로그인 버튼 비활성화
                    const submitBtn = document.getElementById('loginSubmitBtn');
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<span>로그인 중...</span>';
                    
                    try {
                        await handleLogin(username, password);
                    } finally {
                        // 버튼 다시 활성화
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = `
                            <span>로그인</span>
                            <svg class="btn-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        `;
                    }
                });
            }

            // ESC 키로 모달 닫기
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    hideModal();
                }
            });

            console.log('All event listeners set up successfully');
        });

        // 전역 함수로 노출
        window.enterSystem = showModal;
        window.closeModal = hideModal;
        window.handleLogin = handleLogin;
        
        console.log('Landing page script loaded');
    </script>
</body>
</html>
