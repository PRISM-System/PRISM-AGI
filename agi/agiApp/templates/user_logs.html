<!DOCTYPE html>
{% load static %}
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사용자 로그 - PRISM-AGI</title>
    <link rel="icon" type="image/png" href="{% static 'img/image_logo.png' %}">

    <link rel="stylesheet" href="{% static 'css/reset.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/chat.css' %}">
    <link rel="stylesheet" href="{% static 'css/user-logs.css' %}">
</head>
<body class="user-logs-page">
    {% csrf_token %}
    <div class="chat-layout">
        <!-- 좌측 사이드바 -->
        {% include 'partials/sidebar.html' %}
        
        <!-- 메인 로그 영역 -->
        <div class="chat-main">
            <div class="logs-container">
                <div class="logs-header">
                    <div class="header-content">
                        {% if user_id and institution_name %}
                        <div class="user-info-header">
                            <span class="institution-badge">{{ institution_name }}</span>
                            <span class="user-id-badge">{{ user_id }}</span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <h1 class="logs-title">사용자 로그</h1>
                    <p class="logs-subtitle">시스템 활동 및 사용자 행동 기록</p>
                </div>

                <div class="logs-content">
                    <!-- 필터 및 제어 영역 -->
                    <div class="logs-toolbar">
                        <div class="toolbar-left">
                            <div class="date-filter">
                                <label for="startDate">시작일:</label>
                                <input type="date" id="startDate" class="date-input">
                                <label for="endDate">종료일:</label>
                                <input type="date" id="endDate" class="date-input">
                            </div>
                            
                            <div class="filter-container">
                                <select id="logLevelFilter" class="filter-select">
                                    <option value="">모든 레벨</option>
                                    <option value="INFO">정보</option>
                                    <option value="WARNING">경고</option>
                                    <option value="ERROR">오류</option>
                                    <option value="DEBUG">디버그</option>
                                </select>
                                
                                <select id="logCategoryFilter" class="filter-select">
                                    <option value="">모든 카테고리</option>
                                    <option value="agent_create">에이전트 생성</option>
                                    <option value="agent_delete">에이전트 삭제</option>
                                    <option value="tool_register">도구 등록</option>
                                    <option value="tool_delete">도구 삭제</option>
                                    <option value="chat_query">자연어 질의</option>
                                    <option value="chat_response">AI 응답</option>
                                    <option value="session_create">세션 생성</option>
                                    <option value="session_delete">세션 삭제</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="toolbar-right">
                            <div class="search-container">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                                </svg>
                                <input type="text" id="searchLogs" placeholder="로그 검색..." class="search-input">
                            </div>
                            
                            <button class="refresh-btn" id="refreshLogs">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                                </svg>
                                새로고침
                            </button>
                            
                            <button class="export-btn" id="exportLogs">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                                </svg>
                                내보내기
                            </button>
                        </div>
                    </div>

                    <!-- 통계 카드 -->
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon info">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="totalLogs">-</div>
                                <div class="stat-label">총 로그</div>
                            </div>
                        </div>
                        
                        <!-- <div class="stat-card">
                            <div class="stat-icon warning">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12,2L13.09,8.26L22,9L17,14L18.18,23L12,19.77L5.82,23L7,14L2,9L10.91,8.26L12,2Z"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="warningLogs">-</div>
                                <div class="stat-label">경고</div>
                            </div>
                        </div> -->
                        
                        <div class="stat-card">
                            <div class="stat-icon error">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="errorLogs">-</div>
                                <div class="stat-label">오류</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon active">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12,12C13.1,12 14,11.1 14,10C14,8.9 13.1,8 12,8C10.9,8 10,8.9 10,10C10,11.1 10.9,12 12,12M21,9V7L19,5V4A2,2 0 0,0 17,2H7C5.89,2 5,2.89 5,4V5L3,7V9H5V10A2,2 0 0,0 7,12H17A2,2 0 0,0 19,10V9H21M17,10H7V4H17V10Z"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="todayLogs">-</div>
                                <div class="stat-label">오늘</div>
                            </div>
                        </div>
                    </div>

                    <!-- 로그 테이블 -->
                    <div class="logs-table-container">
                        <div class="table-header">
                            <h3>로그 항목</h3>
                            <div class="table-info">
                                <span id="logCount">0개 항목</span>
                            </div>
                        </div>
                        
                        <div class="logs-table-wrapper">
                            <table class="logs-table" id="logsTable">
                                <thead>
                                    <tr>
                                        <th class="sortable" data-sort="timestamp">
                                            시간
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M7,10L12,15L17,10H7Z"/>
                                            </svg>
                                        </th>
                                        <th class="sortable" data-sort="level">
                                            레벨
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M7,10L12,15L17,10H7Z"/>
                                            </svg>
                                        </th>
                                        <th class="sortable" data-sort="category">
                                            카테고리
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M7,10L12,15L17,10H7Z"/>
                                            </svg>
                                        </th>
                                        <th>메시지</th>
                                        <th>상세</th>
                                    </tr>
                                </thead>
                                <tbody id="logsTableBody">
                                    <!-- 로그 항목들이 동적으로 추가됩니다 -->
                                </tbody>
                            </table>
                            
                            <!-- 로딩 상태 -->
                            <div class="loading-container" id="loadingContainer">
                                <div class="loading-spinner"></div>
                                <p>로그를 불러오는 중...</p>
                            </div>
                            
                            <!-- 빈 상태 -->
                            <div class="empty-state" id="emptyState" style="display: none;">
                                <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor" class="empty-icon">
                                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                                </svg>
                                <h3>로그가 없습니다</h3>
                                <p>선택한 조건에 맞는 로그가 없습니다.</p>
                            </div>
                        </div>
                        
                        <!-- 페이지네이션 -->
                        <div class="pagination" id="pagination">
                            <button class="page-btn" id="prevPage" disabled>이전</button>
                            <div class="page-numbers" id="pageNumbers"></div>
                            <button class="page-btn" id="nextPage">다음</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 로그 상세 모달 -->
    <div class="modal-overlay" id="logDetailModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>로그 상세 정보</h3>
                <button class="modal-close" id="closeModal">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="log-detail-section">
                    <h4>기본 정보</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span class="detail-label">시간:</span>
                            <span class="detail-value" id="modalTimestamp">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">레벨:</span>
                            <span class="detail-value" id="modalLevel">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">카테고리:</span>
                            <span class="detail-value" id="modalCategory">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">사용자:</span>
                            <span class="detail-value" id="modalUser">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="log-detail-section">
                    <h4>메시지</h4>
                    <div class="message-content" id="modalMessage">-</div>
                </div>
                
                <div class="log-detail-section">
                    <h4>상세 데이터</h4>
                    <pre class="code-block" id="modalDetails">-</pre>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeModalBtn">닫기</button>
                <button class="btn btn-primary" id="copyLogBtn">복사</button>
            </div>
        </div>
    </div>

    <script src="{% static 'js/logout-handler.js' %}"></script>
    <script src="{% static 'js/activity-logger.js' %}"></script>
    <script src="{% static 'js/user-logs.js' %}"></script>
    <script src="{% static 'js/chat.js' %}"></script>
</body>
</html>
